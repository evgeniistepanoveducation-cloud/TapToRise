<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapToRise - Wheel of Fortune</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family: Arial,sans-serif;}
.bg { position:fixed; inset:0; background-image:url('Gradient_Blue.jpg'); background-size:cover; background-position:center;}
.wrap { position:fixed; inset:0; display:flex; justify-content:center; align-items:center;}
.tap { font-size:48px; width:300px; height:300px; border:none; border-radius:50%; background-color:#2ea6ff; color:#fff; cursor:pointer; box-shadow:0 10px 24px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; touch-action: manipulation; user-select:none;}
.xp-counter { position:fixed; top:20px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:16px 20px; border-radius:16px; font-weight:bold; font-size:32px;}
.level-indicator { position:fixed; top:100px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:10px 16px; border-radius:12px; font-weight:bold; font-size:20px;}
.xp-bar-container { position:fixed; top:0; left:0; width:100%; height:16px; background:rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; z-index:100;}
.xp-bar { height:100%; width:0%; background:linear-gradient(90deg,#ffd700,#ff8c00); transition:width 0.3s ease-out;}
#message { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:black; color:white; padding:20px; border-radius:10px; font-size:20px; z-index:2000;}
#wheelOverlay { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:2000;}
#wheelCanvas { background:white; border-radius:50%; border:4px solid gold; }
#wheelIndicator { position:absolute; top:50%; left:50%; width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-bottom:30px solid red; transform: translate(-50%, -100%); z-index:2001; }
</style>
</head>
<body>
<div class="bg"></div>
<div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
<div class="wrap"><button class="tap" id="tapBtn">ðŸ”¥ TAP! ðŸ”¥</button></div>
<div class="level-indicator" id="levelIndicator">Level: 1</div>
<div class="xp-counter" id="xpCounter">XP: 0</div>
<div id="message"></div>

<!-- Wheel overlay -->
<div id="wheelOverlay">
    <canvas id="wheelCanvas" width="500" height="500"></canvas>
    <div id="wheelIndicator"></div>
</div>

<script>
const prizes = ['ðŸª','ðŸŽ','ðŸ’Ž','ðŸŽ‰','ðŸ•','ðŸ†','ðŸŽ®','ðŸ’°'];
const probabilities = [0.2,0.2,0.2,0.2,0.2,0,0,0].map(p => p / 1);
const colors = ['#FF5733','#33FF57','#3357FF','#FF33A1','#FFD133','#33FFF5','#A133FF','#FF8C33'];

// XP ladder
const xpLadder = [];
xpLadder[1] = 300; // Level 1â†’2
xpLadder[2] = 600; // Level 2â†’3
xpLadder[3] = 1000; // Level 3â†’4
const k = 1.8;
for(let i = 4; i <= 10; i++){
    xpLadder[i] = Math.round(xpLadder[i-1] * k / 100) * 100;
}

// DOM references
const tapBtn = document.getElementById('tapBtn');
const xpCounter = document.getElementById('xpCounter');
const xpBar = document.getElementById('xpBar');
const levelIndicator = document.getElementById('levelIndicator');
const message = document.getElementById('message');
const wheelOverlay = document.getElementById('wheelOverlay');
const wheelCanvas = document.getElementById('wheelCanvas');
const ctx = wheelCanvas.getContext('2d');

let xp = 0, level = 1, lastRouletteXP = 0, rouletteTriggered = false;

// Helper: choose prize by probability
function choosePrizeByProbability() {
    let r = Math.random(), cum = 0;
    for(let i = 0; i < probabilities.length; i++){
        cum += probabilities[i];
        if(r <= cum) return i;
    }
    return probabilities.length - 1;
}

// Draw wheel
function drawWheel(rotation = 0){
    const N = prizes.length;
    const center = wheelCanvas.width / 2;
    const radius = center - 10;
    ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

    for(let i = 0; i < N; i++){
        const startAngle = (i/N)*2*Math.PI + rotation;
        const endAngle = ((i+1)/N)*2*Math.PI + rotation;

        // sector
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        ctx.strokeStyle = "#000"; ctx.lineWidth = 2; ctx.stroke();

        // emoji
        ctx.save();
        ctx.translate(center, center);
        const angle = startAngle + (endAngle - startAngle)/2;
        ctx.rotate(angle);
        ctx.font = "40px Arial";
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.fillText(prizes[i], radius - 20, 10);
        ctx.restore();
    }
}

// Spin wheel animation
function spinWheel(){
    wheelOverlay.style.display = 'flex';
    const chosenIndex = choosePrizeByProbability();
    const N = prizes.length;
    const fullSpins = 5;
    const sectorAngle = 2*Math.PI/N;
    const targetAngle = 3*Math.PI/2 - (chosenIndex + 0.5)*sectorAngle;
    const totalRotation = fullSpins*2*Math.PI + targetAngle;
    let start = null;
    const duration = 3000;

    function animate(timestamp){
        if(!start) start = timestamp;
        const elapsed = timestamp - start;
        const t = Math.min(elapsed / duration, 1);
        const ease = t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3)/2;
        drawWheel(totalRotation * ease);

        if(t < 1){
            requestAnimationFrame(animate);
        } else {
            setTimeout(()=>{
                message.textContent = `You won ${prizes[chosenIndex]}!`;
                message.style.display = 'block';
                wheelOverlay.style.display = 'none';
                setTimeout(()=>{message.style.display = 'none'}, 2000);
                rouletteTriggered = false;
            }, 200);
        }
    }
    requestAnimationFrame(animate);
}

// Tap button logic
tapBtn.addEventListener('click', () => {
    xp += 10;

    // XP bar
    const xpNeeded = xpLadder[level] || xpLadder[xpLadder.length-1]; // handle levels beyond ladder
    xpCounter.textContent = `XP: ${xp}`;
    xpBar.style.width = Math.min((xp / xpNeeded) * 100, 100) + '%';

    // Spin trigger
    if(!rouletteTriggered && xp - lastRouletteXP >= 20){
        rouletteTriggered = true;
        lastRouletteXP = xp;
        spinWheel();
    }

    // Level-up
    while(level < xpLadder.length && xp >= xpLadder[level]){
        xp -= xpLadder[level];
        level++;
        levelIndicator.textContent = `Level: ${level}`;
        const nextXpNeeded = xpLadder[level] || xpLadder[xpLadder.length-1];
        xpBar.style.width = Math.min((xp / nextXpNeeded) * 100, 100) + '%';
        message.textContent = "ðŸŽ‰ Congrats, next level achieved!";
        message.style.display = "block";
        setTimeout(()=>{message.style.display='none'},2000);
    }

    // floating XP
    const xpSign = document.createElement('div');
    xpSign.textContent = '+10 XP';
    xpSign.style.position = 'fixed';
    xpSign.style.left = `${Math.random()*(window.innerWidth-100)}px`;
    xpSign.style.top = `${Math.random()*(window.innerHeight-50)}px`;
    xpSign.style.color = 'yellow';
    xpSign.style.fontWeight = 'bold';
    xpSign.style.fontSize = '24px';
    xpSign.style.pointerEvents = 'none';
    document.body.appendChild(xpSign);
    xpSign.animate([{opacity:1, transform:'translateY(0px)'},{opacity:0, transform:'translateY(-50px)'}],
                   {duration:1000,easing:'ease-out'});
    setTimeout(()=>xpSign.remove(),1000);
});

document.addEventListener('dblclick', e => e.preventDefault(), {passive:false});
drawWheel(); // initial draw

</script>


</body>
</html>
