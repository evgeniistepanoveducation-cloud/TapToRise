<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapToRise - Wheel of Fortune</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family: Arial,sans-serif;}
.bg { position:fixed; inset:0; background-image:url('Gradient_Blue.jpg'); background-size:cover; background-position:center;}
#mainContent { position:relative; width:100%; height:100%; transition: filter 0.3s ease; }

.wrap { position:fixed; inset:0; display:flex; justify-content:center; align-items:center;}
.tap { font-size:48px; width:300px; height:300px; border:none; border-radius:50%; background-color:#2ea6ff; color:#fff; cursor:pointer; box-shadow:0 10px 24px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; touch-action: manipulation; user-select:none;}
.xp-counter { position:fixed; top:20px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:16px 20px; border-radius:16px; font-weight:bold; font-size:32px;}
.level-indicator { position:fixed; top:100px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:10px 16px; border-radius:12px; font-weight:bold; font-size:20px;}
.xp-bar-container { position:fixed; top:0; left:0; width:100%; height:16px; background:rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; z-index:100;}
.xp-bar { height:100%; width:0%; background:linear-gradient(90deg,#ffd700,#ff8c00); transition:width 0.3s ease-out;}
#message { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:black; color:white; padding:20px; border-radius:10px; font-size:20px; z-index:2000;}
#wheelOverlay { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:2000; }
#wheelCanvas { background:white; border-radius:50%; border:4px solid gold; }
#wheelIndicator { position:absolute; top:50%; left:50%; width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-bottom:30px solid red; transform: translate(-50%, -100%); z-index:2001; }
.golden-ticket-counter { position: fixed; top: 160px; left: 20px; background: rgba(255,215,0,0.8); color: #000; padding: 12px 20px; border-radius: 16px; font-weight: bold; font-size: 24px; z-index: 101; }

/* Level-up overlay */
#levelOverlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:3000; flex-direction:column; text-align:center; pointer-events:all; }
#levelOverlay .content { background:#a0d8ff; color:#000; padding:30px 40px; border-radius:20px; font-size:24px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.3); }
#levelOverlay .spin-btn { margin-top:20px; padding:10px 20px; font-size:20px; border:none; border-radius:12px; background:#ffd700; color:#000; cursor:pointer; }
#wheelCanvas { background:white; border-radius:50%; border:4px solid gold; width:80vw; height:80vw; max-width:500px; max-height:500px; min-width:250px; min-height:250px; }

@keyframes goldenFlash { 0% { transform: scale(1); opacity:1; } 50% { transform: scale(1.5); opacity:0.8; } 100% { transform: scale(1); opacity:0; } }
.golden-ticket-animation { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:64px; z-index:3000; animation: goldenFlash 1s ease-out forwards; pointer-events:none; }

#hubBtn { position: fixed; top: 20px; right: 20px; width: 48px; height: 48px; border: none; border-radius: 12px; background: #ffd700; cursor: pointer; z-index: 110; }
#personalHub { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); color: #fff; z-index: 2000; flex-direction: column; align-items: center; padding: 40px 20px; overflow-y: auto; }
.hub-top-row { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
#hubLevelText { font-size: 28px; font-weight: bold; }
#hubProfilePic { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; cursor: pointer; }
#hubLevelName { font-size: 22px; margin-bottom: 16px; }
.hub-xp-bar-container { width: 90%; height: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; margin-bottom: 16px; }
.hub-xp-bar { height: 100%; width: 0%; background: linear-gradient(90deg,#ffd700,#ff8c00); border-radius: 10px; transition: width 0.3s ease-out; }
#hubXpCounter { font-size: 18px; margin-bottom: 16px; }
.referral-code { margin-top: 15px; text-align: center; }
.referral-code label { display: block; margin-bottom: 5px; font-weight: bold; }
.referral-code input { padding: 5px 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; text-align: center; }
.referral-row { display: inline-flex;      /* keep input + button in one row */ align-items: center; justify-content: center; gap: 8px;  /* space between input and button */ }
.referral-row button { padding: 5px 12px; font-size: 14px; border-radius: 8px; border: none; background: #4caf50; color: white; cursor: pointer; transition: background 0.2s; }
.referral-row button:hover { background: #45a049; }
.copy-confirm { margin-top: 6px; font-size: 14px; color: #fff; background: #2ea6ff; padding: 4px 12px; border-radius: 12px; display: inline-block; opacity: 0; transition: opacity 0.5s ease; /* fade effect */ }

</style>
</head>
<body>

<div class="bg"></div>


<div id="personalHub">
    <div class="hub-top-row">
        <div id="hubLevelText">Level 1</div>
        <img src="profile.jpg" alt="Profile" id="hubProfilePic">
    </div>
    
    

    <div id="hubLevelName">test</div>
    <div class="hub-xp-bar-container"><div class="hub-xp-bar" id="hubXpBar"></div></div>
    <div id="hubXpCounter">0/100 XP</div>

    <div id="hubGoldenTicketsWrapper" style="text-align: center; margin-bottom: 16px;">
        <div id="hubGoldenTickets" style="width:80px; height:80px; border-radius:50%; background: gold; display:flex; justify-content:center; align-items:center; font-size:32px; font-weight:bold; color:#000; margin:0 auto;">0</div>
        <div style="margin-top: 8px; font-size: 16px; font-weight: bold;">Your Golden Tickets</div>
</div>


    <div class="referral-code">
        <label for="referralInput">Referral Code:</label>
            <div class="referral-row">
                <input type="text" id="referralInput" value="superdigga228" />
                <button id="copyReferralBtn">Copy</button>
            </div>
            </div>
    <div id="copyConfirm" class="copy-confirm">Copied!</div>

</div>



<div id="mainContent">
    <div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
    <div class="wrap"><button class="tap" id="tapBtn">üî• TAP! üî•</button></div>
    <div class="level-indicator" id="levelIndicator">Level: 1</div>
    <div class="xp-counter" id="xpCounter">XP: 0</div>
    <div class="golden-ticket-counter" id="goldenTicketCounter">üéüÔ∏è 0</div>
    <button id="hubBtn">üè†</button>
</div>

<div id="message"></div>

<!-- Wheel overlay -->
<div id="wheelOverlay">
    <canvas id="wheelCanvas" width="500" height="500"></canvas>

    <div id="wheelIndicator"></div>
</div>

<!-- Level-up overlay -->
<div id="levelOverlay">
    <div class="content">
        üéâ Congrats, next level achieved!<br>
        You earned one spin!
    </div>
    <button id="levelSpinBtn" class="spin-btn">Spin</button>
</div>

<script>
// Default profile picture
const hubProfilePic = document.getElementById('hubProfilePic');
hubProfilePic.src = 'default_profile.jpg';  // default picture


const prizes = ['üç™','üéÅ','üíé','üéâ','üçï','üèÜ','üéÆ','üí∞','üéüÔ∏è']; // last one is Golden Ticket
const probabilities = [0,0,0,0,0,0,0,0,1];
const colors = ['#FF5733','#33FF57','#3357FF','#FF33A1','#FFD133','#33FFF5','#A133FF','#FF8C33'];

// Levels: cumulative XP + level names
    const levels = [
        { xp: 0, name: "Beginner" },       // Level 1
        { xp: 30, name: "Apprentice" },    // Level 2 
        { xp: 60, name: "Novice" },        // Level 3
        { xp: 1000, name: "Expert" }        // Level 4
    ];

    const k = 1.8;
    for(let i = levels.length; i < 10; i++){
        const prevXP = levels[i - 1].xp; 
        const newXP = Math.round(prevXP * k);
        levels.push({ xp: newXP, name: `Level ${i}` }); 
}



const tapBtn=document.getElementById('tapBtn');
const xpCounter=document.getElementById('xpCounter');
const xpBar=document.getElementById('xpBar');
const levelIndicator=document.getElementById('levelIndicator');
const message=document.getElementById('message');
const wheelOverlay=document.getElementById('wheelOverlay');
const wheelCanvas=document.getElementById('wheelCanvas');
const ctx=wheelCanvas.getContext('2d');
const levelOverlay=document.getElementById('levelOverlay');
const levelSpinBtn=document.getElementById('levelSpinBtn');
const mainContent=document.getElementById('mainContent');

//let currentLevelName = "test";
//document.getElementById('hubLevelName').textContent = levels[level].name;

// Create hidden file input
const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.accept = 'image/*';  // only images
fileInput.style.display = 'none';
document.body.appendChild(fileInput);

// When image is clicked, trigger file selection
hubProfilePic.addEventListener('click', () => {
    fileInput.click();
});

// Update the profile picture
fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(ev){
            hubProfilePic.src = ev.target.result;  // update image
        }
        reader.readAsDataURL(file);
    }
});

let xp=0, level=1;
let goldenTickets = 0;
const goldenTicketCounter = document.getElementById('goldenTicketCounter');

// Hup closing
const hubBtn = document.getElementById('hubBtn');
const personalHub = document.getElementById('personalHub');

hubBtn.addEventListener('click', () => { 
    personalHub.style.display = 'flex'; 
    mainContent.style.filter='blur(5px)'; 
});``
personalHub.addEventListener('click', (e) => { 
    if(e.target===personalHub){ 
        personalHub.style.display='none'; 
        mainContent.style.filter='none'; 
    } 
});

// Store referral code dynamically
let referralCode = document.getElementById("referralInput").value;

// Copy referral code
const copyConfirm = document.getElementById("copyConfirm");

document.getElementById("copyReferralBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(referralCode).then(() => {
    copyConfirm.style.opacity = "1";         // fade in
    setTimeout(() => {
      copyConfirm.style.opacity = "0";       // fade out after 1 sec
    }, 1000);
  });
});

document.getElementById("referralInput").addEventListener("input", (e) => {
  referralCode = e.target.value;
  console.log("Referral code updated:", referralCode);
});

// Helper: choose prize by probability
function choosePrizeByProbability(){
    let r=Math.random(),cum=0;
    for(let i=0;i<probabilities.length;i++){ cum+=probabilities[i]; if(r<=cum) return i; }
    return probabilities.length-1;
}

// Draw wheel
function drawWheel(rotation=0){
    const canvasWidth = wheelCanvas.width;
    const canvasHeight = wheelCanvas.height;
    const center = canvasWidth / 2;
    const radius = center - 4; // 4px for the golden border

    ctx.clearRect(0, 0, canvasWidth, canvasHeight);

    const N = prizes.length;

    for(let i=0;i<N;i++){
        const start = (i/N) * 2 * Math.PI + rotation;
        const end = ((i+1)/N) * 2 * Math.PI + rotation;

        // Slice background
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, start, end);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Emoji inside slice
        const angle = start + (end - start)/2;
        const textRadius = radius * 0.85; // slightly inside the slice
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(angle);
        ctx.font = `${Math.round(radius*0.2)}px Arial`; // scale font with radius
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#000";
        ctx.fillText(prizes[i], textRadius, 0);
        ctx.restore();
    }
}

// Spin wheel
function spinWheel(){
    wheelOverlay.style.display='flex';
    mainContent.style.filter='blur(5px)'; // blur background during spin

    const chosenIndex = choosePrizeByProbability();
    const N = prizes.length;
    const fullSpins = 5;
    const sectorAngle = 2 * Math.PI / N;
    const targetAngle = 3 * Math.PI / 2 - (chosenIndex + 0.5) * sectorAngle;
    const totalRotation = fullSpins * 2 * Math.PI + targetAngle;


    let start = null;
    const duration = 3000;

    function animate(ts){
        if(!start) start = ts;
        const elapsed = ts - start;
        const t = Math.min(elapsed / duration, 1);

        // cubic easing in/out
        const ease = t < 0.5
            ? 4 * t * t * t
            : 1 - Math.pow(-2 * t + 2, 3) / 2;

        // scaled drawing at this rotation
        drawWheel(totalRotation * ease);

        if(t < 1){
    requestAnimationFrame(animate);
} else {
    if(prizes[chosenIndex] === 'üéüÔ∏è'){ 
        // Golden Ticket animation
        goldenTickets++;
        goldenTicketCounter.textContent = `üéüÔ∏è ${goldenTickets}`;

         // Sync Golden Tickets inside Hub
        document.getElementById('hubGoldenTickets').textContent = `${goldenTickets}`;

        const flash = document.createElement('div');
        flash.className = 'golden-ticket-animation';
        flash.textContent = 'üéüÔ∏è';
        document.body.appendChild(flash);

        // Animate with Web Animations API
        flash.animate([
            { transform: 'translate(-50%, -50%) scale(0)', opacity: 0 },
            { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 1 },
            { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }
        ], { duration: 1500, easing: 'ease-out' });

        setTimeout(() => {
            flash.remove();
            message.textContent = `You won a Golden Ticket!`;
            message.style.display = 'block';
            wheelOverlay.style.display = 'none';
            mainContent.style.filter = 'none';
            setTimeout(()=>{ message.style.display = 'none'; }, 2000);
        }, 1500);

    } else {
        // normal prizes
        setTimeout(()=>{
            message.textContent = `You won ${prizes[chosenIndex]}!`;
            message.style.display = 'block';
            wheelOverlay.style.display = 'none';
            mainContent.style.filter = 'none';
            setTimeout(()=>{ message.style.display = 'none'; }, 2000);
        }, 200);
    }
}

    }

    requestAnimationFrame(animate);
}

// Show/hide level overlay with background blur
function showLevelOverlay(){
    mainContent.style.filter='blur(5px)';
    levelOverlay.style.display='flex';
}
function hideLevelOverlay(){
    mainContent.style.filter='none';
    levelOverlay.style.display='none';
}

// Tap button logic
let lastXpTime = 0;  // timestamp of last XP gain
const xpCooldown = 200; // ms, i.e., 0.2 sec per XP addition
let levelUpCooldown = false;

tapBtn.addEventListener('click', () => {
    // Block taps if overlay is visible
    if (levelOverlay.style.display === 'flex' || wheelOverlay.style.display === 'flex') return;

    // Cooldown
    const now = Date.now();
    if (now - lastXpTime < xpCooldown) return;
    lastXpTime = now;

    // Add XP
    xp += 10;

    // Original level-up loop
    // Level-up using cumulative thresholds: do NOT subtract XP

    while (level < levels.length && xp >= levels[level].xp) {
    //xp -= levels[level].xp; drops the xp to zero each time new level is reached
    level++;
    showLevelOverlay();
    xpBar.style.width = '0%';
    document.getElementById('hubXpBar').style.width = '0%';
    levelIndicator.textContent = `Level ${level} (${levels[level-1].name})`;
    //document.getElementById('hubLevelText').textContent = `Level ${level} (${levels[level-1].name})`;
    document.getElementById('hubLevelText').textContent = `Level ${level}`;
    document.getElementById('hubLevelName').textContent = levels[level-1].name;
}



    // Update progress bar
    const prevLevelXP = level === 0 ? 0 : levels[level-1].xp;
    const nextLevelXP = level < levels.length ? levels[level].xp : prevLevelXP + 100;
    const progress = Math.min(((xp - prevLevelXP)/ (nextLevelXP - prevLevelXP)), 1);
    xpBar.style.width = `${progress * 100}%`;
    xpCounter.textContent = `${xp}/${nextLevelXP} XP`;
    document.getElementById('hubXpBar').style.width = `${progress * 100}%`;
    document.getElementById('hubXpCounter').textContent = `${xp}/${nextLevelXP} XP`;


    // Floating XP
    const xpSign = document.createElement('div');
    xpSign.textContent = '+10 XP';
    xpSign.style.position = 'fixed';
    xpSign.style.left = `${Math.random() * (window.innerWidth - 100)}px`;
    xpSign.style.top = `${Math.random() * (window.innerHeight - 50)}px`;
    xpSign.style.color = 'yellow';
    xpSign.style.fontWeight = 'bold';
    xpSign.style.fontSize = '24px';
    xpSign.style.pointerEvents = 'none';
    document.body.appendChild(xpSign);
    xpSign.animate(
        [
            { opacity: 1, transform: 'translateY(0px)' },
            { opacity: 0, transform: 'translateY(-50px)' }
        ],
        { duration: 1000, easing: 'ease-out' }
    );
    setTimeout(() => xpSign.remove(), 1000);
});





// Spin button in level overlay
levelSpinBtn.addEventListener('click',()=>{
    hideLevelOverlay();
    spinWheel();
});

document.addEventListener('dblclick',e=>e.preventDefault(),{passive:false});
drawWheel();
</script>

</body>
</html>
