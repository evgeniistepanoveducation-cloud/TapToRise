<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapToRise - Wheel of Fortune</title>
<style>
html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; font-family: Arial,sans-serif;}
.bg { position:fixed; inset:0; background-image:url('Gradient_Blue.jpg'); background-size:cover; background-position:center;}
#mainContent { position:relative; width:100%; height:100%; transition: filter 0.3s ease; }

#tapBtn { width: 220px; height: 220px; border-radius: 50%; border: 6px solid gold; background: linear-gradient(135deg, #ffd700, #ff8c00); color: black; font-size: 70px; font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); /* Vertical positioning: middle between screen top and island top */ position: absolute; top: calc((100vh - 150px) / 2 - 110px);}
.wrap { position: fixed; top: 0; left: 50%; transform: translateX(-50%); /* center horizontally */ display: flex; justify-content: center; }
.tap { font-size:48px; width:300px; height:300px; border:none; border-radius:50%; background-color:#2ea6ff; color:#fff; cursor:pointer; box-shadow:0 10px 24px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; touch-action: manipulation; user-select:none;}
.xp-counter { position:fixed; top:20px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:16px 20px; border-radius:16px; font-weight:bold; font-size:24px;}
.level-indicator { position:fixed; top:100px; left:20px; background:rgba(0,0,0,0.4); color:#fff; padding:10px 16px; border-radius:12px; font-weight:bold; font-size:20px;}
.xp-bar-container { position:fixed; top:0; left:0; width:100%; height:16px; background:rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; z-index:100;}
.xp-bar { height:100%; width:0%; background:linear-gradient(90deg,#ffd700,#ff8c00); transition:width 0.3s ease-out;}
#message { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:black; color:white; padding:20px; border-radius:10px; font-size:20px; z-index:2000;}
#wheelOverlay { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:2000; }
#wheelCanvas { background:white; border-radius:50%; border:4px solid gold; transform: translateY(-40px); /* shift wheel upwards */ }
#wheelIndicator { position:absolute; top:50%; left:50%; width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-bottom:30px solid red; transform: translate(-50%, -100%); z-index:2001; }
.golden-ticket-counter { position: fixed; bottom: 220px; left: 20px; background: rgba(255,215,0,0.8); color: #000; padding: 12px 20px; border-radius: 16px; font-weight: bold; font-size: 24px; z-index: 101; }
.gemsCounter { position: fixed; bottom: 220px; right: 20px; background: rgba(255,215,0,0.8); color: #000; padding: 12px 20px; border-radius: 16px; font-weight: bold; font-size: 24px; z-index: 101; }
.gem-animation { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 64px; z-index: 3000; animation: goldenFlash 1s ease-out forwards; pointer-events: none; }

/* Level-up overlay */
#levelOverlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:3000; flex-direction:column; text-align:center; pointer-events:all; }
#levelOverlay .content { background:#a0d8ff; color:#000; padding:30px 40px; border-radius:20px; font-size:24px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.3); }
#levelOverlay .spin-btn { margin-top:20px; padding:10px 20px; font-size:20px; border:none; border-radius:12px; background:#ffd700; color:#000; cursor:pointer; }
#wheelCanvas { background:white; border-radius:50%; border:4px solid gold; width:80vw; height:80vw; max-width:500px; max-height:500px; min-width:250px; min-height:250px; }

@keyframes goldenFlash { 0% { transform: scale(1); opacity:1; } 50% { transform: scale(1.5); opacity:0.8; } 100% { transform: scale(1); opacity:0; } }
.golden-ticket-animation { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:64px; z-index:3000; animation: goldenFlash 1s ease-out forwards; pointer-events:none; }

.gems-counter { position: fixed; bottom: 220px;  right: 20px;  background: rgba(0, 229, 255, 0.8);  color: #000; padding: 12px 20px; border-radius: 16px; font-weight: bold; font-size: 24px; z-index: 101; }
#personalHub { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); color: #fff; z-index: 2000; flex-direction: column; align-items: center; padding: 40px 20px; overflow-y: auto; }
.hub-top-row { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
#hubLevelText { font-size: 28px; font-weight: bold; }
#hubProfilePic { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; cursor: pointer; }
#hubLevelName { font-size: 22px; margin-bottom: 16px; }
.hub-xp-bar-container { width: 90%; height: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; margin-bottom: 16px; }
.hub-xp-bar { height: 100%; width: 0%; background: linear-gradient(90deg,#ffd700,#ff8c00); border-radius: 10px; transition: width 0.3s ease-out; }
#hubXpCounter { font-size: 18px; margin-bottom: 16px; }
.referral-code { margin-top: 15px; text-align: center; }
.referral-code label { display: block; margin-bottom: 5px; font-weight: bold; }
.referral-code input { padding: 5px 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; text-align: center; }
.referral-row { display: flex;   align-items: center; justify-content: center; gap: 8px; width: 100%; }
.referral-row button { padding: 5px 12px; font-size: 14px; border-radius: 8px; border: none; background: #4caf50; color: white; cursor: pointer; transition: background 0.2s; }
.referral-row button:hover { background: #45a049; }
.copy-confirm { margin-top: 6px; font-size: 14px; color: #fff; background: #2ea6ff; padding: 4px 12px; border-radius: 12px; display: inline-block; opacity: 0; transition: opacity 0.5s ease; }
#leaderboardOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; justify-content: center; align-items: center; }
#leaderboardContainer { background: rgba(0,0,0,0.5); color: #fff; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow: auto; }

#bottomButtons { position: fixed; bottom: 120px; left: 0; width: 100%; height: 80px; display: flex; justify-content: space-around; /* buttons take equal width inside */ align-items: center; /* vertical centering of buttons */ background: transparent; /* island invisible */ border-top: 2px solid grey; /* only top border visible */ border-left: none; border-right: none; border-bottom: none; border-radius: 0; z-index: 110; }
#hubBtn { width: 56px; height: 56px; border: none; border-radius: 12px; background: rgba(255,215,0,0.8); color: #fff; cursor: pointer; font-size: 36px; }
#leaderboardBtn { width: 56px; height: 56px; border: none; border-radius: 12px; background: rgba(255,215,0,0.8); color: #fff; cursor: pointer; font-size: 36px; }

.glow { box-shadow: 0 0 20px gold, 0 0 40px orange; border-radius: 50%; }

#adBanner { position: fixed; bottom: 0; left: 0; width: 100%; height: 120px; background: #222; color: #aaa; display: flex; justify-content: center; align-items: center; border-radius: 10px; z-index: 1000; }

.hub-section-title { font-weight: bold; font-size: 18px; margin-bottom: 8px; color: #fff; }
.hub-inventory-item { width: 50px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: default; transition: transform 0.2s; }
.hub-inventory-item:hover { transform: scale(1.2); }

</style>
</head>
<body>

<div class="bg"></div>


<div id="personalHub">
    <div class="hub-top-row">
        <div id="hubLevelText">Level 1</div>
        <img src="profile.jpg" alt="Profile" id="hubProfilePic">
    </div>
     
    <div id="hubLevelName">test</div>
    <div class="hub-xp-bar-container">
        <div class="hub-xp-bar" id="hubXpBar"></div>
    </div>
    <div id="hubXpCounter">0 XP</div>

    <div id="hubGoldenTicketsWrapper" style="text-align: center; margin-bottom: 16px;">
        <div id="hubGoldenTickets" style="width:80px; height:80px; border-radius:50%; background: gold; display:flex; justify-content:center; align-items:center; font-size:32px; font-weight:bold; color:#000; margin:0 auto;">0</div>
        <div style="margin-top: 8px; font-size: 16px; font-weight: bold;">Your Golden Tickets</div>
    </div>

        <!-- Referral section moved inside personalHub -->
    <div class="referral-code" style="margin-top:16px;">
        <label for="referralInput">Referral Code:</label>
        <div class="referral-row">
            <input type="text" id="referralInput" value="superdigga228" />
            <button id="copyReferralBtn">Copy</button>
        </div>
        <div id="copyConfirm" class="copy-confirm">Copied!</div>
    </div>

    <!-- Inventory section -->
    <div id="hubInventoryWrapper" style="margin-top:16px;">
        <div class="hub-section-title">Inventory</div>
        <div id="hubInventory" class="hub-inventory"></div>
    </div>


</div>


<div id="leaderboardOverlay">
    <div id="leaderboardContainer"></div>
</div>

<div id="mainContent">
    <div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
    <div class="wrap"><button id="tapBtn">TAP</button></div>
        <div class="level-indicator" id="levelIndicator">Level: 1</div>
    <div class="xp-counter" id="xpCounter">0 XP</div>
    <div class="golden-ticket-counter" id="goldenTicketCounter">üéüÔ∏è 0</div>
    <div class="gemsCounter" id="gemsCount">üíé 0</div>
</div>

<div id="bottomButtons">
    <button id="hubBtn">üè†</button>
    <button id="leaderboardBtn">üèÜ</button>
    <button id="shopBtn">üõí</button>
    <button id="challengeBtn">‚öîÔ∏è</button>
</div>

<div id="adBanner">
    [Ad Banner Placeholder]
</div>

<div id="message"></div>

<!-- Wheel overlay -->
<div id="wheelOverlay">
    <canvas id="wheelCanvas" width="500" height="500"></canvas>
    <div id="wheelIndicator"></div>
</div>

<!-- Level-up overlay -->
<div id="levelOverlay">
    <div class="content">
        üéâ Congrats, next level achieved!<br>
        You earned one spin!
    </div>
    <button id="levelSpinBtn" class="spin-btn">Spin</button>
</div>

<div id="hubInventoryWrapper">
    <div class="hub-section-title">Inventory</div>
    <div id="hubInventory" class="hub-inventory"></div>
</div>


<script>
// Default profile picture
const hubProfilePic = document.getElementById('hubProfilePic');
hubProfilePic.src = 'default_profile.jpg';  // default picture


const prizes = ['‚ö° x2 XP','‚úñÔ∏è','100üíé','50üíé','10üíé','üé®','üèÖ','üéØ','üéüÔ∏è'];

// Only for debugging:
const probabilities = [0,0,0,0,0,0,1,0,0];

//const probabilities = [0.25,0.1,0.12,0.18,0.25,0.04,0.02,0.01,0.03];

const colors = ['#FF5733','#33FF57','#3357FF','#FF33A1','#FFD133','#33FFF5','#A133FF','#FF8C33'];

// Levels: cumulative XP + level names
    const levels = [
        { xp: 0, name: "Beginner" },       // Level 1
        { xp: 20, name: "Apprentice" },    // Level 2 
        { xp: 40, name: "Novice" },        // Level 3
        { xp: 400, name: "Expert" }        // Level 4
    ];

    const k = 1.8;
    for(let i = levels.length; i < 10; i++){
        const prevXP = levels[i - 1].xp; 
        const newXP = Math.round(prevXP * k);
        levels.push({ xp: newXP, name: `Level ${i}` }); 
}



const tapBtn=document.getElementById('tapBtn');
const xpCounter=document.getElementById('xpCounter');
const xpBar=document.getElementById('xpBar');
const levelIndicator=document.getElementById('levelIndicator');
const message=document.getElementById('message');
const wheelOverlay=document.getElementById('wheelOverlay');
const wheelCanvas=document.getElementById('wheelCanvas');
const ctx=wheelCanvas.getContext('2d');
const levelOverlay=document.getElementById('levelOverlay');
const levelSpinBtn=document.getElementById('levelSpinBtn');
const mainContent=document.getElementById('mainContent');

//let currentLevelName = "test";
//document.getElementById('hubLevelName').textContent = levels[level].name;

// Create hidden file input
const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.accept = 'image/*';  // only images
fileInput.style.display = 'none';
document.body.appendChild(fileInput);

// When image is clicked, trigger file selection
hubProfilePic.addEventListener('click', () => {
    fileInput.click();
});

// Update the profile picture
fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(ev){
            hubProfilePic.src = ev.target.result;  // update image
        }
        reader.readAsDataURL(file);
    }
});

let xp=0, level=1;
let goldenTickets = 0;
let gems = 0;
const goldenTicketCounter = document.getElementById('goldenTicketCounter');

let xpMultiplier = 1;   // default = no boost
let tapMultiplier = 1;  // default = one tap = one action
let xpMultiplierTimeout = null;
let tapMultiplierTimeout = null;


// Hup closing
const hubBtn = document.getElementById('hubBtn');
const personalHub = document.getElementById('personalHub');

hubBtn.addEventListener('click', () => { 
    personalHub.style.display = 'flex'; 
    mainContent.style.filter='blur(5px)'; 
});``
personalHub.addEventListener('click', (e) => { 
    if(e.target===personalHub){ 
        personalHub.style.display='none'; 
        mainContent.style.filter='none'; 
    } 
});

// Store referral code dynamically
let referralCode = document.getElementById("referralInput").value;

// Copy referral code
const copyConfirm = document.getElementById("copyConfirm");

document.getElementById("copyReferralBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(referralCode).then(() => {
    copyConfirm.style.opacity = "1";         // fade in
    setTimeout(() => {
      copyConfirm.style.opacity = "0";       // fade out after 1 sec
    }, 1000);
  });
});

document.getElementById("referralInput").addEventListener("input", (e) => {
  referralCode = e.target.value;
  console.log("Referral code updated:", referralCode);
});

// Helper: choose prize by probability
function choosePrizeByProbability(){
    let r=Math.random(),cum=0;
    for(let i=0;i<probabilities.length;i++){ cum+=probabilities[i]; if(r<=cum) return i; }
    return probabilities.length-1;
}

// Draw wheel
function drawWheel(rotation=0){
    const canvasWidth = wheelCanvas.width;
    const canvasHeight = wheelCanvas.height;
    const center = canvasWidth / 2;
    const radius = center - 4; // 4px for the golden border

    ctx.clearRect(0, 0, canvasWidth, canvasHeight);

    const N = prizes.length;

    for(let i=0;i<N;i++){
        const start = (i/N) * 2 * Math.PI + rotation;
        const end = ((i+1)/N) * 2 * Math.PI + rotation;

        // Slice background
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, start, end);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Emoji inside slice
        const angle = start + (end - start)/2;
        const textRadius = radius * 0.7; // slightly inside the slice
        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(angle);
        let fontSize = Math.round(radius * 0.12); // slightly larger than 0.1
        if (fontSize < 22) fontSize = 22; // minimum readable size for mobile
        ctx.font = `${fontSize}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#000";
        ctx.fillText(prizes[i], textRadius, 0);
        ctx.restore();
    }
}

// Spin wheel
function spinWheel(){
    wheelOverlay.style.display='flex';
    mainContent.style.filter='blur(5px)'; // blur background during spin

    const chosenIndex = choosePrizeByProbability();
    const N = prizes.length;
    const fullSpins = 5;
    const sectorAngle = 2 * Math.PI / N;
    const targetAngle = 3 * Math.PI / 2 - (chosenIndex + 0.5) * sectorAngle;
    const totalRotation = fullSpins * 2 * Math.PI + targetAngle;


    let start = null;
    const duration = 3000;

    function animate(ts){
        if(!start) start = ts;
        const elapsed = ts - start;
        const t = Math.min(elapsed / duration, 1);

        // cubic easing in/out
        const ease = t < 0.5
            ? 4 * t * t * t
            : 1 - Math.pow(-2 * t + 2, 3) / 2;

        // scaled drawing at this rotation
        drawWheel(totalRotation * ease);

        if(t < 1){
    requestAnimationFrame(animate);
} else {
    // --- prize handling (replace inside animate's else) ---
if (prizes[chosenIndex] === 'üéüÔ∏è') {
    // Golden Ticket
    goldenTickets++;
    goldenTicketCounter.textContent = `üéüÔ∏è ${goldenTickets}`;
    const hubEl = document.getElementById('hubGoldenTickets');
    if (hubEl) hubEl.textContent = `${goldenTickets}`;

    const flash = document.createElement('div');
    flash.className = 'golden-ticket-animation';
    flash.textContent = 'üéüÔ∏è';
    document.body.appendChild(flash);

    flash.animate([
        { transform: 'translate(-50%, -50%) scale(0)', opacity: 0 },
        { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }
    ], { duration: 1500, easing: 'ease-out' });

    setTimeout(() => {
        flash.remove();
        message.textContent = `You won a Golden Ticket!`;
        message.style.display = 'block';
        wheelOverlay.style.display = 'none';
        mainContent.style.filter = 'none';
        setTimeout(()=>{ message.style.display = 'none'; }, 2000);
    }, 1500);

} else if (prizes[chosenIndex].includes('üíé')) {
    // Gems: safe numeric parse, increment, UI update + flash
    const raw = String(prizes[chosenIndex] || '');
    const amount = parseInt(raw.replace(/\D/g, ''), 10) || 0;
    gems += amount; // global variable must exist

    // update UI (keep emoji so box size stays stable)
    const gemsEl = document.getElementById('gemsCount') || document.getElementById('gemsCounter') || document.querySelector('.gemsCounter') || document.querySelector('.gems-counter');
    if (gemsEl) gemsEl.textContent = `üíé ${gems}`;

    const flash = document.createElement('div');
    flash.className = 'gem-animation'; // uses the same keyframes or new class
    flash.textContent = `üíé ${amount}`; // template literal - shows correct amount
    document.body.appendChild(flash);

    flash.animate([
        { transform: 'translate(-50%, -50%) scale(0)', opacity: 0 },
        { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }
    ], { duration: 1500, easing: 'ease-out' });

    setTimeout(() => {
        flash.remove();
        message.textContent = `You won ${prizes[chosenIndex]}!`;
        message.style.display = 'block';
        wheelOverlay.style.display = 'none';
        mainContent.style.filter = 'none';
        setTimeout(() => { message.style.display = 'none'; }, 2000);
    }, 1500);

} else if (prizes[chosenIndex] === '‚ö° x2 XP') {
    // Double XP multiplier for 2 minutes
    xpMultiplier = 2;
    // optional: clear/extend previous timeout logic (see note below)
    setTimeout(() => { xpMultiplier = 1; }, 120000);

    // show feedback and close wheel (mirror other branches)
    message.textContent = `2x XP activated for 2 minutes!`;
    message.style.display = 'block';
    wheelOverlay.style.display = 'none';
    mainContent.style.filter = 'none';
    setTimeout(()=>{ message.style.display = 'none'; }, 2000);

} else if (prizes[chosenIndex] === '‚úñÔ∏è') {
    // x5 taps per tap multiplier for 1 minute
    tapMultiplier = 5;
    //setTimeout(() => { tapMultiplier = 1; }, 60000);
    clearTimeout(tapMultiplierTimeout);
    tapMultiplierTimeout = setTimeout(() => { tapMultiplier = 1; }, 60000);

    message.textContent = `x5 taps active for 1 minute!`;
    message.style.display = 'block';
    wheelOverlay.style.display = 'none';
    mainContent.style.filter = 'none';
    setTimeout(()=>{ message.style.display = 'none'; }, 2000);

} else if (prizes[chosenIndex] === 'üé®') {
    // Make profile picture glow; correct selector
    const pic = document.getElementById('hubProfilePic') || document.getElementById('hubProfilePic');
    if (pic) pic.classList.add('glow');
    setTimeout(() => { if (pic) pic.classList.remove('glow'); }, 120000);

    message.textContent = `Profile picture glowing!`;
    message.style.display = 'block';
    wheelOverlay.style.display = 'none';
    mainContent.style.filter = 'none';
    setTimeout(()=>{ message.style.display = 'none'; }, 2000);

} else if (prizes[chosenIndex] === 'üèÖ') {
    // Add Badge to Inventory (stackable)
    const badgeName = 'Badge';
    const badgeIcon = 'üèÖ';

    // Check if badge already exists in inventory
    const existing = inventory.find(item => item.name === badgeName);
    if (existing) {
        existing.count = (existing.count || 1) + 1; // increment count
    } else {
        inventory.push({ name: badgeName, icon: badgeIcon, count: 1 });
    }

    renderInventory(); // update hub

    // Show feedback message
    message.textContent = `You won a Badge! üéâ`;
    message.style.display = 'block';
    wheelOverlay.style.display = 'none';
    mainContent.style.filter = 'none';
    setTimeout(() => { message.style.display = 'none'; }, 2000);


} else if (prizes[chosenIndex] === 'üéØ') {
    // Instant respin ‚Äî keep overlay visible and start another spin after a small delay
    setTimeout(() => {
        spinWheel();
    }, 300);

} else {
    // safety: all prizes should be handled explicitly above
    console.error("Unhandled prize:", prizes[chosenIndex]);
    // close overlay to avoid frozen UI
    wheelOverlay.style.display = 'none';
    mainContent.style.filter = 'none';
}

}
    }

    requestAnimationFrame(animate);
}

// Show/hide level overlay with background blur
function showLevelOverlay(){
    mainContent.style.filter='blur(5px)';
    levelOverlay.style.display='flex';
}
function hideLevelOverlay(){
    mainContent.style.filter='none';
    levelOverlay.style.display='none';
}

// Tap button logic
let lastXpTime = 0;  // timestamp of last XP gain
const xpCooldown = 200; // ms, i.e., 0.2 sec per XP addition
let levelUpCooldown = false;

// Initial display when game loads
levelIndicator.textContent = `Level ${level} (${levels[level-1].name})`;
document.getElementById('hubLevelText').textContent = `Level ${level}`;
document.getElementById('hubLevelName').textContent = levels[level-1].name;


tapBtn.addEventListener('click', () => {
    // Block taps if overlay is visible
    if (levelOverlay.style.display === 'flex' || wheelOverlay.style.display === 'flex') return;

    // Cooldown
    const now = Date.now();
    if (now - lastXpTime < xpCooldown) return;
    lastXpTime = now;

    // Add XP
    xp += 10 * xpMultiplier * tapMultiplier;

    // Original level-up loop
    // Level-up using cumulative thresholds: do NOT subtract XP

    while (level < levels.length && xp >= levels[level].xp) {
    level++;
    showLevelOverlay();
    xpBar.style.width = '0%';
    document.getElementById('hubXpBar').style.width = '0%';
    levelIndicator.textContent = `Level ${level} (${levels[level-1].name})`;
    //document.getElementById('hubLevelText').textContent = `Level ${level} (${levels[level-1].name})`;
    document.getElementById('hubLevelText').textContent = `Level ${level}`;
    document.getElementById('hubLevelName').textContent = levels[level-1].name;
}



    // Update progress bar
    const prevLevelXP = level === 0 ? 0 : levels[level-1].xp;
    const nextLevelXP = level < levels.length ? levels[level].xp : prevLevelXP + 100;
    const progress = Math.min(((xp - prevLevelXP)/ (nextLevelXP - prevLevelXP)), 1);
    xpBar.style.width = `${progress * 100}%`;
    xpCounter.textContent = `${xp}/${nextLevelXP} XP`;
    document.getElementById('hubXpBar').style.width = `${progress * 100}%`;
    document.getElementById('hubXpCounter').textContent = `${xp}/${nextLevelXP} XP`;


    // Floating XP signs (respects multipliers)
    for (let i = 0; i < tapMultiplier; i++) {
        const xpSign = document.createElement('div');
        xpSign.textContent = `+${10 * xpMultiplier} XP`; // scale with xpMultiplier
        xpSign.style.position = 'fixed';
        xpSign.style.left = `${Math.random() * (window.innerWidth - 100)}px`;
        xpSign.style.top = `${Math.random() * (window.innerHeight - 50)}px`;

        // Color logic
            if (tapMultiplier > 1 && xpMultiplier > 1) {
                xpSign.style.background = 'linear-gradient(to right, purple, pink)';
                xpSign.style.webkitBackgroundClip = 'text';
                xpSign.style.backgroundClip = 'text';
                xpSign.style.color = 'transparent';
            } else if (tapMultiplier > 1) {
                xpSign.style.color = 'purple';
            } else if (xpMultiplier > 1) {
                xpSign.style.color = 'pink';
            } else {
                xpSign.style.color = 'yellow';
        }

        //xpSign.style.color = 'yellow';
        xpSign.style.fontWeight = 'bold';
        xpSign.style.fontSize = '24px';
        xpSign.style.pointerEvents = 'none';
        document.body.appendChild(xpSign);

        xpSign.animate(
            [
                { opacity: 1, transform: 'translateY(0px)' },
                { opacity: 0, transform: 'translateY(-50px)' }
            ],
            { duration: 1000, easing: 'ease-out' }
        );

    setTimeout(() => xpSign.remove(), 1000);
    }

}

);


// Spin button in level overlay
levelSpinBtn.addEventListener('click',()=>{
    hideLevelOverlay();
    spinWheel();
});

document.addEventListener('DOMContentLoaded', () => {

    /////////////////////////
    // MVP Leaderboard Setup
    /////////////////////////

    // Fake users
    const fakeUsers = [
      { username: "Alpha", baseXP: 10000 },
      { username: "Bravo", baseXP: 20000 },
      { username: "Charlie", baseXP: 24000 },
      { username: "Delta", baseXP: 100000 },
      { username: "Echo", baseXP: 50000 },
      { username: "Foxtrot", baseXP: 30000 },
      { username: "Golf", baseXP: 12000 },
      { username: "Hotel", baseXP: 45000 },
      { username: "India", baseXP: 80000 },
      { username: "Juliet", baseXP: 60000 }
    ];

    // Real player
    let realPlayer = { username: "YOU", xp: xp, level: level };

    // Generate bot XP once per session
    function calculateBotXP() {
      fakeUsers.forEach(bot => {
        const randomXP = Math.floor((5000 + Math.random() * 50000) / 10) * 10; 
        bot.currentXP = bot.baseXP + randomXP;
      });
    }

    function updateRealPlayerXP() {
      realPlayer.xp = xp; 
    }

    function getTopLeaderboard() {
      const combined = [...fakeUsers, realPlayer];
      combined.sort((a, b) => (b.currentXP || b.xp) - (a.currentXP || a.xp));
      const top10 = combined.slice(0, 10);
      return top10.includes(realPlayer) ? top10 : top10.slice(0, 10);
    }

    function renderLeaderboard() {
      const container = document.getElementById("leaderboardContainer");
      if(!container) return; // safety
      container.innerHTML = "";
      const top10 = getTopLeaderboard();


    top10.forEach((user, idx) => {
    const row = document.createElement("div");
    row.className = "leaderboard-row";
    row.style.display = "flex";
    row.style.alignItems = "center";
    row.style.padding = "0 8px";          // left/right padding only
    row.style.height = "60px";            // fixed height
    row.style.marginBottom = "5px";
    row.style.borderRadius = "4px";
    row.style.background = "rgba(0,0,0,0.4)";  // semi-transparent, like hub

    if (idx === 0) row.style.background = "rgba(255, 215, 0, 0.4)";    // gold
    else if (idx === 1) row.style.background = "rgba(192,192,192,0.4)"; // silver
    else if (idx === 2) row.style.background = "rgba(205,127,50,0.4)";  // bronze

    // Rank
    const rank = document.createElement("span");
    rank.textContent = `#${idx + 1}`;
    rank.style.width = "30px";
    rank.style.textAlign = "center";

    // Profile picture
    const pic = document.createElement("img");
    pic.src = user.username === "YOU" ? hubProfilePic.src : "James.jpeg";
    pic.style.width = "50px";
    pic.style.height = "50px";
    pic.style.borderRadius = "50%";
    pic.style.margin = "0 8px";

    // Name
    const name = document.createElement("span");
    name.textContent = user.username;
    name.style.flex = "1";
    name.style.whiteSpace = "nowrap";
    name.style.overflow = "hidden";
    name.style.textOverflow = "ellipsis";

    // XP
    const xpText = document.createElement("span");
    xpText.textContent = user === realPlayer ? `${user.xp}` : `${user.currentXP}`;
    xpText.style.width = "60px";
    xpText.style.textAlign = "right";

    row.append(rank, pic, name, xpText);
    container.appendChild(row);
});


    }

    calculateBotXP();
    updateRealPlayerXP();
    renderLeaderboard();

    setInterval(() => {
      updateRealPlayerXP();
      renderLeaderboard();
    }, 1000);

    const leaderboardBtn = document.getElementById('leaderboardBtn');
    const leaderboardOverlay = document.getElementById('leaderboardOverlay');
  
    leaderboardBtn.addEventListener('click', () => {
        leaderboardOverlay.style.display = 'flex';
        mainContent.style.filter = 'blur(5px)'; 
        renderLeaderboard(); 
    });

    leaderboardOverlay.addEventListener('click', (e) => {
    // Only close if background itself is clicked, not the container
    if (e.target === leaderboardOverlay) {
        leaderboardOverlay.style.display = 'none';
        mainContent.style.filter = 'none';
    }
    });
}); 

// Inventory
let inventory = []; // store objects: { name: 'Golden Badge', icon: 'üèÖ' }

    // Add an item
    function addInventoryItem(name, icon) {
        inventory.push({ name, icon });
        renderInventory();
    }

    // Render inventory in hub
    function renderInventory() {
    const hubInventory = document.getElementById('hubInventory');
    if (!hubInventory) return;

    hubInventory.innerHTML = ''; // clear previous items

    inventory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'hub-inventory-item';

        // Icon
        const iconEl = document.createElement('div');
        iconEl.textContent = item.icon;
        iconEl.style.fontSize = '24px';
        div.appendChild(iconEl);

        // Counter below icon
        if (item.count && item.count > 1) {
            const countEl = document.createElement('div');
            countEl.textContent = `x${item.count}`;
            countEl.style.fontSize = '14px';
            countEl.style.marginTop = '2px';
            countEl.style.color = '#fff';
            div.appendChild(countEl);
        }

        hubInventory.appendChild(div);
    });
}




document.addEventListener('dblclick',e=>e.preventDefault(),{passive:false});
drawWheel();
</script>

</body>
</html>
